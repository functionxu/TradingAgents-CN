# TradingAgents 后端微服务测试计划

## 📋 测试概述

本文档描述了TradingAgents后端微服务系统的完整测试计划，包括单个服务测试、集成测试和端到端测试。

## 🏗️ 系统架构

### 微服务列表
| 服务名称 | 端口 | 功能描述 | 状态 |
|---------|------|----------|------|
| API Gateway | 8000 | 统一API入口，请求路由 | ✅ 运行中 |
| Analysis Engine | 8001 | 分析引擎，协调分析流程 | ✅ 运行中 |
| Data Service | 8002 | 数据获取和管理 | ✅ 运行中 |
| Task Scheduler | 8003 | 任务调度和管理 | 🔄 待测试 |
| LLM Service | 8004 | LLM模型服务 | ✅ 运行中 |
| Memory Service | 8006 | 记忆管理服务 | 🔄 待测试 |
| Agent Service | 8008 | 智能体管理和协作 | ✅ 运行中 |

### 基础设施
- **MongoDB** (27017) - 数据库服务
- **Redis** (6379) - 缓存服务

## 🧪 测试分类

### 1. 健康检查测试
验证所有服务的基本可用性。

### 2. 数据服务测试
- 股票信息查询
- 历史数据获取
- 基本面数据查询
- 新闻数据获取
- 缓存机制验证

### 3. LLM服务测试
- 模型可用性检查
- 聊天完成接口
- 文本分析功能
- 使用统计

### 4. 分析引擎测试
- 启动分析任务
- 查询分析进度
- 获取分析结果
- 错误处理

### 5. API网关测试
- 请求路由功能
- 参数传递验证
- 错误处理
- 负载均衡

### 6. 智能体服务测试
- 智能体创建
- 协作功能
- 状态管理

### 7. 集成测试
- 完整分析流程
- 多服务协作
- 数据一致性

## 📊 测试用例

### TC001: 系统健康检查
**目标**: 验证所有服务正常运行
**步骤**:
1. 检查API Gateway健康状态
2. 检查各个微服务健康状态
3. 验证数据库连接
4. 验证Redis连接

**期望结果**: 所有服务返回200状态码

### TC002: 股票信息查询
**目标**: 验证股票基础信息查询功能
**测试数据**:
- 000001 (平安银行)
- 600519 (贵州茅台)
- 000002 (万科A)

**步骤**:
1. 通过API Gateway查询股票信息
2. 验证返回数据格式
3. 验证数据内容准确性
4. 测试缓存机制
5. 测试强制刷新功能

### TC003: LLM服务功能测试
**目标**: 验证LLM服务的各项功能
**步骤**:
1. 获取可用模型列表
2. 测试聊天完成接口
3. 测试文本分析功能
4. 查看使用统计

### TC004: 完整分析流程测试
**目标**: 验证端到端的股票分析流程
**步骤**:
1. 启动股票分析任务
2. 监控分析进度
3. 获取分析结果
4. 验证结果质量

### TC005: 错误处理测试
**目标**: 验证系统的错误处理能力
**步骤**:
1. 测试无效股票代码
2. 测试服务不可用情况
3. 测试参数错误
4. 测试超时处理

## 🔧 测试环境要求

### 前置条件
- Python 3.10+ 环境
- MongoDB 运行在 localhost:27017
- Redis 运行在 localhost:6379
- 所有微服务正常启动

### 环境变量
```bash
# API密钥配置
DEEPSEEK_API_KEY=your_deepseek_key
DASHSCOPE_API_KEY=your_dashscope_key
TUSHARE_TOKEN=your_tushare_token

# 数据库配置
MONGODB_URL=mongodb://localhost:27017
REDIS_URL=redis://localhost:6379

# 日志配置
LOG_LEVEL=INFO
DEBUG=false
```

## 📈 测试指标

### 性能指标
- **响应时间**: API响应时间 < 2秒
- **并发处理**: 支持10个并发请求
- **缓存命中率**: > 80%

### 功能指标
- **数据准确性**: 股票信息准确率 > 95%
- **分析质量**: LLM分析结果相关性 > 90%
- **系统稳定性**: 连续运行24小时无故障

## 🚨 故障排除

### 常见问题
1. **服务启动失败**: 检查端口占用和依赖服务
2. **数据库连接失败**: 验证MongoDB/Redis服务状态
3. **API调用失败**: 检查API密钥配置
4. **缓存问题**: 清除Redis缓存重试

### 日志查看
```bash
# 查看服务日志
tail -f logs/data-service.log
tail -f logs/analysis-engine.log
tail -f logs/llm-service.log
```

## 📝 测试报告模板

### 测试执行记录
- **测试日期**: 
- **测试环境**: 
- **测试人员**: 
- **测试版本**: 

### 测试结果汇总
- **通过用例数**: 
- **失败用例数**: 
- **跳过用例数**: 
- **总体通过率**: 

### 问题记录
| 问题ID | 问题描述 | 严重程度 | 状态 | 备注 |
|--------|----------|----------|------|------|
|        |          |          |      |      |

## 🔄 持续集成

### 自动化测试
- 每次代码提交触发基础测试
- 每日执行完整回归测试
- 每周执行性能测试

### 监控告警
- 服务健康状态监控
- API响应时间监控
- 错误率监控
- 资源使用监控
