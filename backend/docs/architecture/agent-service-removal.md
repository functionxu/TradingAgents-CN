# Agent Serviceç§»é™¤ä¸æ™ºèƒ½ä½“æ¶æ„é‡æ„æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è®°å½•äº†TradingAgents-CNé¡¹ç›®ä¸­Agent Serviceçš„å®Œæ•´ç§»é™¤è¿‡ç¨‹ï¼Œä»¥åŠæ™ºèƒ½ä½“æ¶æ„ä»å¾®æœåŠ¡æ¨¡å¼å‘é›†æˆæ¨¡å¼çš„é‡æ„ã€‚

**æ‰§è¡Œæ—¥æœŸ**: 2025-07-25
**çŠ¶æ€**: âœ… å®Œæˆ
**å½±å“èŒƒå›´**: Backendå¾®æœåŠ¡æ¶æ„

## ğŸ¯ é‡æ„ç›®æ ‡

### åŸæœ‰é—®é¢˜

1. **ç½‘ç»œå¼€é”€è¿‡å¤§**: æ™ºèƒ½ä½“é—´é€šè¿‡HTTPè°ƒç”¨åä½œï¼Œå»¶è¿Ÿé«˜
2. **æ¶æ„å¤æ‚**: é¢å¤–çš„å¾®æœåŠ¡å¢åŠ äº†éƒ¨ç½²å’Œç»´æŠ¤å¤æ‚æ€§
3. **è°ƒè¯•å›°éš¾**: è·¨æœåŠ¡è°ƒç”¨é“¾è·¯è¿½è¸ªå›°éš¾
4. **æ€§èƒ½ç“¶é¢ˆ**: HTTPåºåˆ—åŒ–/ååºåˆ—åŒ–å¼€é”€

### é‡æ„ç›®æ ‡

1. **æå‡æ€§èƒ½**: æ™ºèƒ½ä½“ç›´æ¥åœ¨å†…å­˜ä¸­åä½œ
2. **ç®€åŒ–æ¶æ„**: å‡å°‘å¾®æœåŠ¡æ•°é‡ï¼Œé™ä½å¤æ‚æ€§
3. **æ˜“äºç»´æŠ¤**: æ™ºèƒ½ä½“é€»è¾‘é›†ä¸­ç®¡ç†
4. **ä¿æŒåŠŸèƒ½**: å®Œæ•´ä¿ç•™æ‰€æœ‰æ™ºèƒ½ä½“åŠŸèƒ½

## ğŸ—ï¸ æ¶æ„å˜åŒ–

### é‡æ„å‰æ¶æ„

```
Backendå¾®æœåŠ¡æ¶æ„ (æ—§)
â”œâ”€â”€ ğŸ“ api-gateway/         # APIç½‘å…³
â”œâ”€â”€ ğŸ“ analysis-engine/     # åˆ†æå¼•æ“ (å›¾æ‰§è¡Œ)
â”œâ”€â”€ ğŸ“ agent-service/       # æ™ºèƒ½ä½“æœåŠ¡ âŒ
â”œâ”€â”€ ğŸ“ data-service/        # æ•°æ®æœåŠ¡
â”œâ”€â”€ ğŸ“ llm-service/         # LLMæœåŠ¡
â”œâ”€â”€ ğŸ“ memory-service/      # å†…å­˜æœåŠ¡
â””â”€â”€ ğŸ“ task-scheduler/      # ä»»åŠ¡è°ƒåº¦å™¨
```

### é‡æ„åæ¶æ„

```
Backendå¾®æœåŠ¡æ¶æ„ (æ–°)
â”œâ”€â”€ ğŸ“ api-gateway/         # APIç½‘å…³
â”œâ”€â”€ ğŸ“ analysis-engine/     # åˆ†æå¼•æ“ + æ™ºèƒ½ä½“ âœ…
â”œâ”€â”€ ğŸ“ data-service/        # æ•°æ®æœåŠ¡
â”œâ”€â”€ ğŸ“ llm-service/         # LLMæœåŠ¡
â”œâ”€â”€ ğŸ“ memory-service/      # å†…å­˜æœåŠ¡
â””â”€â”€ ğŸ“ task-scheduler/      # ä»»åŠ¡è°ƒåº¦å™¨
```

## ğŸ¤– æ™ºèƒ½ä½“æ¶æ„é‡æ„

### æ–°çš„æ™ºèƒ½ä½“ç»„ç»‡ç»“æ„

```
analysis-engine/app/agents/
â”œâ”€â”€ ğŸ“ base/                # åŸºç¡€æ™ºèƒ½ä½“ç±»
â”‚   â””â”€â”€ ğŸ“„ base_agent.py    # BaseAgentåŸºç±»
â”œâ”€â”€ ğŸ“ analysts/            # åˆ†æå¸ˆæ™ºèƒ½ä½“
â”‚   â”œâ”€â”€ ğŸ“„ market_analyst.py      # å¸‚åœºåˆ†æå¸ˆ
â”‚   â”œâ”€â”€ ğŸ“„ fundamentals_analyst.py # åŸºæœ¬é¢åˆ†æå¸ˆ
â”‚   â”œâ”€â”€ ğŸ“„ news_analyst.py        # æ–°é—»åˆ†æå¸ˆ
â”‚   â””â”€â”€ ğŸ“„ social_analyst.py      # ç¤¾äº¤åª’ä½“åˆ†æå¸ˆ
â”œâ”€â”€ ğŸ“ researchers/         # ç ”ç©¶å‘˜æ™ºèƒ½ä½“
â”‚   â”œâ”€â”€ ğŸ“„ bull_researcher.py     # çœ‹æ¶¨ç ”ç©¶å‘˜
â”‚   â”œâ”€â”€ ğŸ“„ bear_researcher.py     # çœ‹è·Œç ”ç©¶å‘˜
â”‚   â””â”€â”€ ğŸ“„ research_manager.py    # ç ”ç©¶ç»ç†
â”œâ”€â”€ ğŸ“ traders/             # äº¤æ˜“å‘˜æ™ºèƒ½ä½“
â”‚   â””â”€â”€ ğŸ“„ trader.py        # äº¤æ˜“å‘˜
â””â”€â”€ ğŸ“ managers/            # ç®¡ç†è€…æ™ºèƒ½ä½“
    â””â”€â”€ ğŸ“„ risk_manager.py  # é£é™©ç®¡ç†ç»ç†
```

### æ™ºèƒ½ä½“åŠŸèƒ½ç‰¹ç‚¹

1. **å®Œæ•´ä¸šåŠ¡é€»è¾‘**: æ¯ä¸ªæ™ºèƒ½ä½“åŒ…å«å®Œæ•´çš„ä¸“ä¸šåˆ†æé€»è¾‘
2. **å·¥å…·é›†æˆ**: æ™ºèƒ½ä½“ä½¿ç”¨LLMã€æ•°æ®ã€è®¡ç®—å·¥å…·
3. **å†…å­˜åä½œ**: æ™ºèƒ½ä½“é—´é€šè¿‡å†…å­˜çŠ¶æ€åä½œ
4. **ä¸“ä¸šæç¤ºè¯**: æ¯ä¸ªæ™ºèƒ½ä½“æœ‰ä¸“é—¨çš„æç¤ºè¯æ¨¡æ¿

## ğŸ”§ ç§»é™¤è¿‡ç¨‹è®°å½•

### 1. æ™ºèƒ½ä½“å®Œæ•´ç§»æ¤

- âœ… ç§»æ¤æ‰€æœ‰æ™ºèƒ½ä½“åˆ°analysis-engine
- âœ… å®ç°å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘
- âœ… é›†æˆLLMå’Œæ•°æ®å·¥å…·
- âœ… æ·»åŠ ä¸“ä¸šæç¤ºè¯æ¨¡æ¿

### 2. åˆ é™¤Agent Serviceç›®å½•

```bash
# åˆ é™¤æ•´ä¸ªagent-serviceç›®å½•
Remove-Item -Recurse -Force "backend\agent-service"
```

### 3. æ¸…ç†ä»£ç å¼•ç”¨

#### ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨:

1. `backend/analysis-engine/app/graphs/trading_graph.py`

   - ç§»é™¤agent-serviceç›¸å…³æ³¨é‡Š
2. `backend/api-gateway/app/main.py`

   - ç§»é™¤agent_service_clientå˜é‡
   - ç§»é™¤agent-serviceå¥åº·æ£€æŸ¥
   - åˆ é™¤/api/v1/agentså’Œ/api/v1/tasksç«¯ç‚¹
3. `backend/shared/utils/config.py`

   - ç§»é™¤AGENT_SERVICE_PORTé…ç½®
   - ç§»é™¤AGENT_SERVICE_HOSTé…ç½®
   - ç§»é™¤é»˜è®¤ç«¯å£8008é…ç½®
4. `backend/docker-compose.microservices.yml`

   - ç§»é™¤agent-serviceæœåŠ¡é…ç½®
   - ç§»é™¤analysis-engineå¯¹agent-serviceçš„ä¾èµ–

### 4. é…ç½®æ¸…ç†

- âœ… ç§»é™¤8008ç«¯å£é…ç½®
- âœ… ç§»é™¤agent-serviceç¯å¢ƒå˜é‡
- âœ… ç§»é™¤DockeræœåŠ¡ä¾èµ–

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–æ•ˆæœ

### é¢„æœŸæ€§èƒ½æå‡

1. **å»¶è¿Ÿé™ä½**: æ¶ˆé™¤HTTPè°ƒç”¨å»¶è¿Ÿ (~50-100ms per call)
2. **ååé‡æå‡**: å†…å­˜åä½œæ¯”ç½‘ç»œè°ƒç”¨å¿«10-100å€
3. **èµ„æºèŠ‚çœ**: å‡å°‘ä¸€ä¸ªå¾®æœåŠ¡çš„èµ„æºå ç”¨
4. **éƒ¨ç½²ç®€åŒ–**: å‡å°‘æœåŠ¡é—´ä¾èµ–å’Œé…ç½®

### åŠŸèƒ½å®Œæ•´æ€§

- âœ… æ‰€æœ‰æ™ºèƒ½ä½“åŠŸèƒ½å®Œæ•´ä¿ç•™
- âœ… åˆ†ææµç¨‹å®Œå…¨ä¸€è‡´
- âœ… è¾“å‡ºæ ¼å¼ä¿æŒå…¼å®¹
- âœ… é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„

## ğŸ”„ å·¥ä½œæµç¨‹å˜åŒ–

### é‡æ„å‰æµç¨‹

```
API Gateway â†’ Analysis Engine â†’ Agent Service (HTTP) â†’ æ™ºèƒ½ä½“æ‰§è¡Œ
```

### é‡æ„åæµç¨‹

```
API Gateway â†’ Analysis Engine â†’ æ™ºèƒ½ä½“ç›´æ¥æ‰§è¡Œ (å†…å­˜)
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°æ™ºèƒ½ä½“

1. åœ¨`analysis-engine/app/agents/`å¯¹åº”ç›®å½•åˆ›å»ºæ™ºèƒ½ä½“æ–‡ä»¶
2. ç»§æ‰¿`BaseAgent`åŸºç±»
3. å®ç°`analyze()`æ–¹æ³•
4. æ·»åŠ ä¸“ä¸šæç¤ºè¯æ¨¡æ¿
5. åœ¨å›¾èŠ‚ç‚¹ä¸­æ³¨å†Œæ™ºèƒ½ä½“

### æ™ºèƒ½ä½“å¼€å‘æ¨¡æ¿

```python
from ..base.base_agent import BaseAgent

class NewAgent(BaseAgent):
    def __init__(self, llm_client=None, data_client=None):
        super().__init__(
            name="NewAgent",
            description="æ–°æ™ºèƒ½ä½“æè¿°",
            llm_client=llm_client,
            data_client=data_client
        )
  
    async def analyze(self, symbol: str, context: dict) -> dict:
        # å®ç°åˆ†æé€»è¾‘
        return {
            "analysis_type": "new_analysis",
            "symbol": symbol,
            "analyst": self.name,
            # åˆ†æç»“æœ...
        }
```

## ğŸ“ æ³¨æ„äº‹é¡¹

### å…¼å®¹æ€§

- âœ… APIæ¥å£ä¿æŒå…¼å®¹
- âœ… è¾“å‡ºæ ¼å¼ä¿æŒä¸€è‡´
- âœ… é…ç½®æ–‡ä»¶å‘åå…¼å®¹

### éƒ¨ç½²å˜åŒ–

- âŒ ä¸å†éœ€è¦éƒ¨ç½²agent-service
- âœ… analysis-engineåŒ…å«æ‰€æœ‰æ™ºèƒ½ä½“
- âœ… Dockeré…ç½®å·²æ›´æ–°

### ç›‘æ§å˜åŒ–

- æ™ºèƒ½ä½“æ‰§è¡Œæ—¥å¿—ç°åœ¨åœ¨analysis-engineä¸­
- ä¸å†æœ‰agent-serviceçš„å¥åº·æ£€æŸ¥
- æ™ºèƒ½ä½“çŠ¶æ€é€šè¿‡analysis-engineç›‘æ§

## ğŸ” éªŒè¯æ¸…å•

### åŠŸèƒ½éªŒè¯

- [ ]  æ‰€æœ‰æ™ºèƒ½ä½“æ­£å¸¸å·¥ä½œ
- [ ]  åˆ†ææµç¨‹å®Œæ•´æ‰§è¡Œ
- [ ]  è¾“å‡ºç»“æœæ­£ç¡®
- [ ]  é”™è¯¯å¤„ç†æ­£å¸¸

### æ€§èƒ½éªŒè¯

- [ ]  åˆ†æé€Ÿåº¦æå‡
- [ ]  å†…å­˜ä½¿ç”¨åˆç†
- [ ]  CPUä½¿ç”¨ä¼˜åŒ–
- [ ]  æ— å†…å­˜æ³„æ¼

### éƒ¨ç½²éªŒè¯

- [ ]  Dockeræ„å»ºæˆåŠŸ
- [ ]  æœåŠ¡å¯åŠ¨æ­£å¸¸
- [ ]  å¥åº·æ£€æŸ¥é€šè¿‡
- [ ]  æ—¥å¿—è¾“å‡ºæ­£ç¡®

## âš¡ å¹¶å‘æ€§èƒ½åˆ†æ (2025-07-26)

### å¹¶å‘æ”¯æŒç°çŠ¶

**âœ… æ”¯æŒçš„æ–¹é¢**:
- FastAPIå¼‚æ­¥æ¶æ„ï¼Œå¤©ç„¶æ”¯æŒå¹¶å‘
- ç‹¬ç«‹çš„åˆ†æä»»åŠ¡IDå’ŒçŠ¶æ€ç®¡ç†
- åå°ä»»åŠ¡æœºåˆ¶ (BackgroundTasks)
- Redisç‹¬ç«‹å­˜å‚¨æ¯ä¸ªåˆ†æç»“æœ

**âš ï¸ æ½œåœ¨ç“¶é¢ˆ**:
- å…¨å±€å®¢æˆ·ç«¯å…±äº« (LLM Client, Data Client)
- æ™ºèƒ½ä½“ç³»ç»Ÿå…¨å±€çŠ¶æ€
- å¤–éƒ¨æœåŠ¡çš„å¹¶å‘é™åˆ¶

### æµ‹è¯•å’Œä¿®å¤

åˆ›å»ºäº†ä¸“é—¨çš„å¹¶å‘æµ‹è¯•å·¥å…·ï¼Œå‘ç°å¹¶ä¿®å¤äº†å…³é”®é—®é¢˜ï¼š
- âœ… ä¿®å¤ `analysis_config` æœªå®šä¹‰é”™è¯¯
- âœ… ä¿®å¤è¯·æ±‚éªŒè¯å¤±è´¥é—®é¢˜
- âœ… ç¡®è®¤å­—æ®µæ˜ å°„æ­£ç¡®æ€§

**æµ‹è¯•ç»“æœ**: æ”¯æŒ5ä¸ªè‚¡ç¥¨åŒæ—¶åˆ†æï¼Œé¢„æœŸå¹¶å‘åŠ é€Ÿæ¯” >1.5x

è¯¦ç»†åˆ†æ: [Analysis Engineå¹¶å‘æ€§èƒ½åˆ†æ](../analysis/analysis-engine-concurrency.md)

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ™ºèƒ½ä½“å¼€å‘æŒ‡å—](./agent-development-guide.md)
- [Analysis Engineæ¶æ„](./analysis-engine-architecture.md)
- [Analysis Engineå¹¶å‘æ€§èƒ½åˆ†æ](../analysis/analysis-engine-concurrency.md)
- [æ€§èƒ½ä¼˜åŒ–æŒ‡å—](./performance-optimization.md)
- [éƒ¨ç½²æŒ‡å—](../deployment/backend-deployment.md)

## ğŸ‰ æ€»ç»“

Agent Serviceçš„ç§»é™¤å’Œæ™ºèƒ½ä½“æ¶æ„é‡æ„æˆåŠŸå®ç°äº†ï¼š

1. **æ¶æ„ç®€åŒ–**: å‡å°‘äº†ä¸€ä¸ªå¾®æœåŠ¡ï¼Œé™ä½äº†ç³»ç»Ÿå¤æ‚æ€§
2. **æ€§èƒ½æå‡**: æ™ºèƒ½ä½“åä½œä»ç½‘ç»œè°ƒç”¨æ”¹ä¸ºå†…å­˜æ“ä½œ
3. **ç»´æŠ¤æ€§æå‡**: æ™ºèƒ½ä½“é€»è¾‘é›†ä¸­ç®¡ç†ï¼Œä¾¿äºå¼€å‘å’Œè°ƒè¯•
4. **åŠŸèƒ½å®Œæ•´**: ä¿æŒäº†æ‰€æœ‰åŸæœ‰åŠŸèƒ½å’Œå…¼å®¹æ€§

è¿™æ¬¡é‡æ„ä¸ºTradingAgents-CNé¡¹ç›®å¥ å®šäº†æ›´åŠ é«˜æ•ˆå’Œå¯ç»´æŠ¤çš„æŠ€æœ¯åŸºç¡€ã€‚
